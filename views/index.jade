!=partial('register')

!=partial('map')

.container.content#chat-area
  #editor-area
    #avatar
      img(src='/images/noavatar.png')
    form#send-message
      textarea#message
      button Send
  #navigation-area.span-4
    .navigation-item
      span broadcast
    .navigation-item
      span system
  #message-area.span-20.last
    #global-messages.message-box
      #nicknames
      #lines

script
  // dom manipulation
  $(function () {
    $('#send-message').submit(function () {
      if (nachbar.me.name == "") {
        $("#nickname").dialog({
          autoOpen: true,
          position: 'center',
          modal: true,
          close: function() {
            if (nachbar.me) $('#send-message').submit();
          }
        })
        return false;
      } else {
        nachbar.me.broadcast($('#message').val());
        $('#message').val('').focus();
        return false;
      }
    });

    $("#message").keyup(function(event){
      if(event.keyCode == 13){
        $("#send-message button").click();
      }
    });

    //message function : interface to other modules
    nachbar.view = nachbar.view || {};
    nachbar.view.message = function (from, msg) {
      if(!msg) return;

      dt = new Date;
      msg = msg.replace(/\\n/g, "<br/>");
      $('#global-messages #lines').prepend($('<p>').append(dt.toLocaleTimeString(), $('<b>').text(from), msg));
    };

  })

